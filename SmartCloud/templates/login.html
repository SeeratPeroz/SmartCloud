{% load static %}
<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Clever Cloud – Login</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet"/>

  <style>
    :root{ --ink:#0f172a; --muted:#64748b; --accent:#2fa6a0; --accent-2:#58d1b9; }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:"Inter",system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;color:var(--ink);background:#fff;overflow-x:hidden}

    /* ===== HERO ===== */
    .hero{
      min-height:100vh; position:relative; display:grid; place-items:center;
      background:#0b1014 url("https://images.pexels.com/photos/305568/pexels-photo-305568.jpeg") center/cover no-repeat;
      isolation:isolate;
    }
    .hero::after{
      content:""; position:absolute; inset:0; z-index:0;
      background:
        radial-gradient(1200px 600px at 20% 10%, rgba(47,166,160,.22), transparent 60%),
        linear-gradient(180deg, rgba(11,16,20,.70), rgba(11,16,20,.72));
    }
    .hero-inner{position:relative; z-index:1; text-align:center; color:#fff; padding:24px}

    /* Title: per-letter entrance + hover */
    .title{
      margin:0 0 16px; letter-spacing:.12em; text-transform:uppercase; font-weight:800;
      font-size:clamp(32px,7.2vw,96px); display:inline-block; will-change:transform;
      transition: letter-spacing .35s ease, transform .25s ease;
    }
    .title .char{
      display:inline-block; opacity:0; transform:translateY(22px) scale(.96); filter:blur(6px);
      animation: letterIn .85s cubic-bezier(.2,.7,.2,1) forwards; position:relative;
      transition: transform .25s ease, text-shadow .25s ease;
    }
    .title:hover{ letter-spacing:.16em; transform: translateY(-2px) }
    .title:hover .char{ transform: translateY(-2px); text-shadow: 0 0 18px rgba(88,209,185,.35) }
    @keyframes letterIn{ to{opacity:1; transform:translateY(0) scale(1); filter:blur(0)} }

    .subtitle{
      margin:0 auto 34px; max-width:820px; color:#dbeafe;
      font-size:clamp(14px,2.4vw,22px); font-weight:400;
      opacity:0; transform:translateY(8px); animation: subIn .8s ease .15s forwards;
    }
    @keyframes subIn{to{opacity:1; transform:translateY(0)}}

    /* Scroll hint (white, clickable) */
    .scroll-hint{
      position:absolute; bottom:28px; left:50%; transform:translateX(-50%);
      color:#fff; display:flex; flex-direction:column; align-items:center; gap:10px;
      cursor:pointer; user-select:none;
    }
    .scroll-hint a{ color:#fff; text-decoration:none }
    .scroll-hint a:hover{ opacity:.9 }
    .scroll-hint .text{ font-weight:700; letter-spacing:.08em }
    .scroll-hint .sep{ margin:0 .25em }
    .chev{ width:28px; height:28px; border-right:3px solid currentColor; border-bottom:3px solid currentColor; transform:rotate(45deg); animation:bob 1.8s ease-in-out infinite}
    @keyframes bob{0%,100%{transform:translateY(0) rotate(45deg)}50%{transform:translateY(8px) rotate(45deg)}}

    /* ===== LOGOS ===== */
    .logos{background:#f8fafc;padding:26px 10px;display:flex;flex-wrap:wrap;justify-content:center;align-items:center;gap:min(5vw,42px);border-top:1px solid #eef2f7;border-bottom:1px solid #eef2f7}
    .logo{height:44px;width:auto;transition:transform .22s ease}
    .logo.center{height:56px}
    .logo-wrap:hover .logo{transform:scale(1.06)}

    /* ===== MODAL ===== */
    .modal{
      position:fixed; inset:0; display:flex; align-items:center; justify-content:center;
      background: rgba(0,0,0,.62);
      opacity:0; visibility:hidden; pointer-events:none;
      transition: opacity .4s ease, visibility .4s ease; z-index:50;
    }
    .modal::before{
      content:""; position:absolute; inset:0; pointer-events:none; opacity:.14;
      background:
        linear-gradient(60deg, rgba(255,255,255,.05) 1px, transparent 1px) 0 0 / 24px 24px,
        linear-gradient(-60deg, rgba(255,255,255,.03) 1px, transparent 1px) 0 0 / 24px 24px;
      mix-blend-mode: screen;
    }
    .modal.is-open{ opacity:1; visibility:visible; pointer-events:auto; }

    .modal-container{
      width:min(940px,94vw); display:flex; border-radius:16px; overflow:hidden; background:#fff;
      transform: translateY(80px) scale(.96); opacity:0; transition:.5s cubic-bezier(.2,.7,.2,1);
      box-shadow: 0 30px 80px rgba(0,0,0,.35); position:relative;
    }
    .modal.is-open .modal-container{ transform:translateY(0) scale(1); opacity:1 }

    .modal-left{ flex:1.3; padding:44px 34px; background:#fff; }
    .modal-title{ font-size:28px; margin:0 0 6px; font-weight:800; color:#0b1014 }
    .modal-desc{ margin:0 0 22px; color:#64748b }

    .field{ margin:0 0 16px; position:relative; }
    .label{display:block;font-size:12px;font-weight:700;letter-spacing:.08em;text-transform:uppercase;color:#667085;margin:0 0 8px}
    .input{
      width:100%; font-size:16px; padding:14px; border:1px solid #e5e7eb; border-radius:12px; outline:0; background:#fbfcfd;
      transition:border-color .2s, box-shadow .2s, background .2s;
    }
    .input:focus{ border-color:var(--accent); box-shadow:0 0 0 6px rgba(45,164,160,.20); background:#fff }

    /* Eye toggle */
    .toggle-pass{
      position:absolute; right:12px; top:34px; width:34px; height:34px;
      display:grid; place-items:center; border:none; background:transparent; cursor:pointer;
      color:#64748b;
    }
    .toggle-pass:hover{ color:#0f172a }

    .modal-buttons{ display:flex; justify-content:space-between; align-items:center; gap:16px; margin-top:10px }
    .btn{
      appearance:none;border:0;border-radius:12px;padding:12px 18px;cursor:pointer;font-weight:800;letter-spacing:.04em;
      background:linear-gradient(135deg,var(--accent),var(--accent-2));color:#fff;box-shadow:0 10px 22px rgba(47,166,160,.25);
      transition:transform .15s ease, box-shadow .2s ease;
    }
    .btn:hover{ transform:translateY(-1px); box-shadow:0 16px 30px rgba(47,166,160,.33) }

    .modal-right{ flex:1; font-size:0; overflow:hidden; background:#000; }
    .modal-right img{ width:100%; height:100%; object-fit:cover; filter:brightness(.9) contrast(1.05) }

    .icon-button{
      position:absolute; right:10px; top:10px; width:36px; height:36px; border:0; background:transparent; cursor:pointer; padding:0;
      color:#fff; opacity:.9;
    }

    .messages{ margin:10px 0 0; padding:0; list-style:none }
    .messages li{ font-size:14px; color:#c0392b; padding:6px 0 }

    @media (max-width: 860px){
      .modal-container{ flex-direction:column }
      .modal-right{ height:220px }
    }
  </style>
</head>
<body>

  <!-- ===== HERO ===== -->
  <section class="hero">
    <div class="hero-inner">
      <h1 class="title" id="brandTitle">CLEVER <span> &nbsp;  </span> CLOUD</h1>
      <p class="subtitle">Willkommen zurück. Organisieren Sie Ihre Praxis effizient und greifen Sie sicher auf Ihre Daten zu.</p>
    </div>
    <div class="scroll-hint" id="scrollHint" aria-label="Login öffnen">
      <a href="#" id="openLoginLink" class="text" role="button" aria-controls="loginModal">
        RUNTER SCROLLEN <span class="sep">oder</span> hier klicken
      </a>
      <div class="chev" aria-hidden="true"></div>
    </div>
  </section>

  <!-- ===== LOGOS ===== -->
  <section class="logos" aria-label="Partner-Logos">
    <span class="logo-wrap"><img class="logo" src="{% static 'brand/rheine.png' %}" alt="Smile Health"></span>
    <span class="logo-wrap"><img class="logo" src="{% static 'brand/merseburg.png' %}" alt="ZMVZ Merseburg"></span>
    <span class="logo-wrap"><img class="logo center" src="{% static 'brand/denshealth.png' %}" alt="Dens Health Management"></span>
    <span class="logo-wrap"><img class="logo" src="{% static 'brand/sachsenpraxen.png' %}" alt="Sachsen Praxen"></span>
    <span class="logo-wrap"><img class="logo" src="{% static 'brand/smilehealth.png' %}" alt="Smile Health (alt)"></span>
  </section>

  <!-- ===== MODAL LOGIN ===== -->
  <div class="modal" id="loginModal" aria-hidden="true">
    <div class="modal-container" role="dialog" aria-modal="true" aria-labelledby="loginTitle">
      <div class="modal-left">
        <h1 class="modal-title" id="loginTitle">Willkommen!</h1>
        <p class="modal-desc">Bitte loggen Sie sich ein, um Ihre Arbeit in der Praxis effizient zu organisieren.</p>

        {% if messages %}
          <ul class="messages">
            {% for message in messages %}
              <li>{{ message }}</li>
            {% endfor %}
          </ul>
        {% endif %}

        <form id="loginForm" method="POST" action="{% url 'login' %}" autocomplete="on" novalidate>
          {% csrf_token %}
          <div class="field">
            <label for="username" class="label">Benutzername</label>
            <input class="input" type="text" name="username" id="username" placeholder="Benutzername" required autofocus>
          </div>
          <div class="field">
            <label for="password" class="label">Passwort</label>
            <input class="input" type="password" name="password" id="password" placeholder="Passwort" required>
            <button type="button" class="toggle-pass" id="togglePass" aria-label="Passwort anzeigen/ausblenden" title="Passwort anzeigen/ausblenden">
              <!-- Eye icons -->
              <svg id="eyeOpen" xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
                <path d="M12 5c-5.5 0-9.5 3.6-11 6.5C2.5 14.4 6.5 18 12 18s9.5-3.6 11-6.5C21.5 8.6 17.5 5 12 5zm0 11c-2.6 0-4.5-2-4.5-4.5S9.4 7 12 7s4.5 2 4.5 4.5S14.6 16 12 16zm0-7.5A3 3 0 1 0 15 11.5 3 3 0 0 0 12 8.5z"/>
              </svg>
              <svg id="eyeClosed" xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 24 24" style="display:none;">
                <path d="M3.3 2.3 2 3.6 5 6.7C3.4 7.9 2.1 9.3 1 11.5 2.5 14.4 6.5 18 12 18c2.1 0 3.9-.5 5.5-1.3l3.5 3.5 1.3-1.3L3.3 2.3zM12 16c-2.6 0-4.5-2-4.5-4.5 0-.5.1-1 .2-1.4l5.7 5.7c-.4.1-.9.2-1.4.2zm8.5-4.5c-.8-1.6-2.2-3-3.9-4.1l-1.6 1.6A4.48 4.48 0 0 1 16.5 11.5c0 1-.3 2-.9 2.7l1.3 1.3c2.1-1.1 3.8-2.8 4.6-5z"/>
              </svg>
            </button>
          </div>
          <div class="modal-buttons">
            <a href="#" style="color:var(--muted); text-decoration:none;">Passwort vergessen?</a>
            <button type="submit" class="btn">Anmelden</button>
          </div>
        </form>
      </div>

      <div class="modal-right" aria-hidden="true">
        <img src="https://images.pexels.com/photos/5355919/pexels-photo-5355919.jpeg" alt="Zahnbehandlung">
      </div>

      <button class="icon-button close-button" type="button" aria-label="Modal schließen">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="32" height="32" fill="white">
          <path d="M25 3C12.9 3 3 12.9 3 25s9.9 22 22 22 22-9.9 22-22S37.1 3 25 3zm7.7 31.3L25 26.6l-7.7 7.7-2.3-2.3 7.7-7.7-7.7-7.7 2.3-2.3 7.7 7.7 7.7-7.7 2.3 2.3-7.7 7.7 7.7 7.7-2.3 2.3z"/>
        </svg>
      </button>
    </div>
  </div>

  <script>
  document.addEventListener('DOMContentLoaded', function () {
    /* Build animated title letters */
    var title = document.getElementById('brandTitle');
    if (title) {
      var text = title.textContent.trim();
      title.textContent = '';
      for (var i = 0; i < text.length; i++) {
        var span = document.createElement('span');
        span.textContent = text[i];
        span.className = 'char';
        span.style.animationDelay = (i * 0.045) + 's';
        span.style.transitionDelay = (i * 0.015) + 's';
        title.appendChild(span);
      }
    }

    /* Modal wiring (no optional chaining to avoid parse issues) */
    var modal      = document.getElementById('loginModal');
    var closeBtn   = document.querySelector('.close-button');
    var scrollHint = document.getElementById('scrollHint');
    var openLink   = document.getElementById('openLoginLink');
    var logos      = document.querySelector('.logos');

    var opened = false;

    function openModal(){
      if (opened || !modal) return;
      opened = true;
      modal.classList.add('is-open');
      modal.setAttribute('aria-hidden','false');
      document.body.style.overflow = 'hidden';
      setTimeout(function(){
        var u = document.getElementById('username');
        if (u && u.focus) u.focus();
      }, 320);
    }

    function closeModal(){
      if (!modal) return;
      modal.classList.remove('is-open');
      modal.setAttribute('aria-hidden','true');
      document.body.style.overflow = 'initial';
      opened = false; // re-arm
    }

    if (scrollHint) {
      scrollHint.addEventListener('click', function(e){ e.preventDefault(); if (!opened) openModal(); });
    }
    if (openLink) {
      openLink.addEventListener('click', function(e){ e.preventDefault(); if (!opened) openModal(); });
    }

    // Open on small scroll (~15% viewport)
    function onScroll(){ if (!opened && window.scrollY > window.innerHeight * 0.15) openModal(); }
    window.addEventListener('scroll', onScroll, { passive:true });

    // Fallback: open when logos strip enters viewport
    if ('IntersectionObserver' in window && logos){
      var io = new IntersectionObserver(function(entries){
        var entry = entries[0];
        if (entry && entry.isIntersecting && !opened) openModal();
      }, { threshold:0.1 });
      io.observe(logos);
    }

    if (closeBtn) closeBtn.addEventListener('click', closeModal);
    if (modal) modal.addEventListener('click', function(e){ if (e.target === modal) closeModal(); });
    window.addEventListener('keydown', function(e){ if (e.key === 'Escape') closeModal(); });

    /* Show/Hide password */
    var passInput = document.getElementById('password');
    var toggle    = document.getElementById('togglePass');
    var eyeOpen   = document.getElementById('eyeOpen');
    var eyeClosed = document.getElementById('eyeClosed');

    if (toggle) {
      toggle.addEventListener('click', function(){
        if (!passInput) return;
        var show = passInput.type === 'password';
        passInput.type = show ? 'text' : 'password';
        if (eyeOpen && eyeClosed){
          eyeOpen.style.display   = show ? 'none' : '';
          eyeClosed.style.display = show ? '' : 'none';
        }
      });
    }
  });
  </script>
</body>
</html>
